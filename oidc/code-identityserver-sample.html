<!DOCTYPE html>
<html>
    <head>
        <title>API</title>
        <link rel='stylesheet' href='app.css'>
    </head>
    <body>
        <a href="index.html"> Back to configuration </a> <br>
        <a href="code-identityserver-sample.html"> Authorize again </a> <br> <br>
        <section>
            <div>
                Configure your client redirect URL to: <br>
                <input type="text" id="redirectUrl" readonly value=". . ." />
            </div>
            <hr>
            <ul>
                <li><label>Authority: </label><input type="text" id="authority" placeholder="https://demo.identityserver.io/"/></li>
                <li><label>ClientId: </label><input type="text" id="clientId" /></li>
                <li><label>DeviceID: </label><input type="text" id="deviceId" placeholder="1824D326-43CE-4676-8168-83AEC699F677"/></li>
                <li><label>Login Hint: </label><input type="text" id="login" placeholder="user@mail.com"/></li>
            </ul>
            <hr>
            <button id="load"> Load configuration </button>
            <button id="submit"> Apply configuration </button>
            <hr>
            <pre id='out'></pre>
        </section>
        <section>
        <div>
            <div>Before start using API samples, you need to get an access token.</div>
            <button id='getToken'>Get Token</button>
        </div>
        <div id="waitText" hidden>Wait... </div>
        <div id="APIs" hidden>
            <a class='functions' href="voicemailAPI.html" >Voicemail API</a>
            <a class='functions' href="voicemailSettingsAPI.html" >Voicemail Settings API</a>
            <a class='functions' href="addressBookAPI.html">Address Book API</a>
        </div>
        </section>
        <br><br>
        <script src='oidc-client.js'></script>
        <script src='code-identityserver-sample.js'></script>
        <script src='jwt-decode.js'></script>
        <script src='log.js'></script>
        <script>
            let url = location.href.split('?')[0];
            document.getElementById('redirectUrl').value = url.substring(0, url.lastIndexOf('/')) + '/code-identityserver-sample.html'; 
            document.getElementById('submit').addEventListener("click", applyConfiguration, false);
            document.getElementById('load').addEventListener("click", loadConfiguration, false);
            function readConfig() {
                log("Current configuration:");
                log(`cfg-authority = ${localStorage.getItem('cfg-authority')}`);
                log(`cfg-clientId = ${localStorage.getItem('cfg-clientId')}`);
                log(`cfg-acr = ${localStorage.getItem('cfg-acr')}`);
                log(`cfg-login = ${localStorage.getItem('cfg-login')}`);
            }
            function applyConfiguration(){
                const authority = document.getElementById('authority').value;
                const clientId = document.getElementById('clientId').value;
                const deviceId = document.getElementById('deviceId').value;
                const login = document.getElementById('login').value;
                localStorage.setItem('cfg-authority', authority);
                localStorage.setItem('cfg-clientId', clientId);
                localStorage.setItem('cfg-acr', `deviceId:${deviceId}`);
                localStorage.setItem('cfg-login', login);
                readConfig();
            }
            function loadConfiguration(){
                document.getElementById('authority').value = localStorage.getItem('cfg-authority');
                document.getElementById('clientId').value = localStorage.getItem('cfg-clientId');
                document.getElementById('deviceId').value = localStorage.getItem('cfg-acr').substr("deviceId:".length);
                document.getElementById('login').value = localStorage.getItem('cfg-login');
            }
            window.onload = readConfig;
        </script>
    </body>
</html>
